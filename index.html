<!DOCTYPE html>
<html lang="en">
<head>
  <title> Picross Solver </title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" type="image/png" href="ressources/favicon.png"/>
  <!-- Bootstrap 5.0 CSS style -->
  <link rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
    crossorigin="anonymous">
  <!-- CSS style -->
  <link rel="stylesheet" href="ressources/main.css">
</head>
<body>

<div class="container-fluid main-wrapper p-5">
  <div class="row">
    <div class="col">
      <div class="input-group">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Select Picross</button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#">Picross 1</a></li>
          <li><a class="dropdown-item" href="#">Picross 2</a></li>
          <li><a class="dropdown-item" href="#">Picross 3</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="#">New picross: <span id="dim-x">10</span> x <span id="dim-y">15</span> </a></li>
        </ul>
        <span class="input-group-text">Dimensions</span>
        <input type="text" aria-label="Largeur"  class="form-control" onchange="document.getElementById('dim-x').innerText = this.value;">
        <input type="text" aria-label="Longueur" class="form-control" onchange="document.getElementById('dim-y').innerText = this.value;">
      </div>
    </div>
  </div>
</div>

<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
  crossorigin="anonymous">
</script>
<script>

class State {
  constructor(i, color=0) {
    this.i = i;
    this.color = color;
    this.preceding = null; // One of these states must be preceding this one
    this.following = null; // One of these states must be following this one
    this.next = null;
    this.prev = null;
  }
  
  toString() { return this.i + (this.color ? '(b)' : ''); }
  
  setNext(state=null) {
    this.next = state;
    this.following = new Set(this.color ? [state] : [state, this]);
    this.following.delete(null);
  }
  setPrev(state=null) {
    this.prev = state;
    this.preceding = new Set(this.color ? [state] : [state, this])
    this.preceding.delete(null);
  }
}

const specificationSplitter = /[^0-9]+/;
class LineSpecification {
  constructor(txt, isRow=true) {
    this.isRow= isRow;
    this.values = txt.split(specificationSplitter).map((x)=>parseInt(x));
    if (this.values.some((x)=>x<=0)) {
      throw new Error('Only strictly positive integers permitted on specifications!');
    }
    // Each black squares + separating whites (or even 0 if spec is empty)
    this.minSize = this.values.length ? this.values.reduce((x,y)=>x+y,0) + this.values.length - 1 : 0;
    
    // One state for each black squares + separating whites + first and last (facultative) whites
    this.nbStates = this.minSize === 0 ? 1 : this.minSize+2;
    // Default states with color 0
    this.states = new Array(nbStates);
    // Setting states color
    this.states[0] = new State(0,0); // Start with a white state
    let c = 1;
    for (const v of this.values) {
      for (let i = 0; i < v; i++) {
        this.states[c] = new State(c++,1); // Fill each segment with that many black state
      }
      this.states[c] = new State(c++,0); // Add an extra white state separator
    }
    // Setting next, previous, preceding and following states
    this.states.forEach(function(s,i) {
      if (i > 0                   ) { s.setPrev( this.states[i-1] ); }
      if (i < this.states.length-1) { s.setNext( this.states[i+1] ); }
    });
  }
  
  toString() {
    return this.values.join('.');
  }
  
  /*
  [1,1,2]
  [0, 1, 0, 1, 0, 1, 1, 0]  8
  #
  0-  0,1
  1-  0,1,2
  2-  0,1,2,3
  3-  0,1,2,3,4
  4-    1,2,3,4,5
  5-      2,3,4,5,6
  6-        3,4,5,6,7
  7-          4,5,6,7
  8-            5,6,7
  9-              6,7
  # (10)
  */
  fillLine(line) {
    const size = line.length;
    for (let i = 0; i < size; i++) {
      line[i] = this.initialStates(size, i);
    }
  }
  
  // All states initially possible at position {i} in a line of size {size}
  initialStates(size, i) {
    // (size-i-1) cells remain after cell i
    // min + (size-i-1) >= minSize = nbState-2
    const min = Math.max(0, this.nbStates - size + i - 1);
    // max <= i + 1
    const max = Math.min(this.nbStates-1, i + 1);
    if (max < min) {
      throw new Error(`Specification ${this} too long for line of size ${size} : [${i}; ${min}, ${max}]`);
    }
    const res = new Set();
    for (let v = min; v <= max; v++) {
      res.add(this.states[v]);
    }
    return res;
  }
}

class PicrossSpecification {
  constructor(height, width) {
    this.rowSpecs = new Array(height);
    this.colSpecs = new Array(width);
  }
  height() { return this.rowSpecs.length; }
  width() { return this.colSpecs.length; }
}


class Cell {
  constructor(i, j, height, width, rowSpec, colSpec) {
    this.i = i;
    this.j = j;
    this.rowSpec = rowSpec;
    this.colSpec = colSpec;
    this.rowStates = rowSpec.initialStates(width , j);
    this.colStates = colSpec.initialStates(height, i);
  }
}

class Picross {
  constructor(specs) {
    this.heigth = specs.height();
    this.width  = specs.width();
    this.specs = specs;
    // The cells are an array of rows which are arrays of cells.
    this.cells = new Array(this.heigth);
    for (let i = 0; i < this.height; i++) {
      this.cells[i] = new Array(this.width);
      for (let j = 0; j < this.width; j++) {
        this.cells[i][j] = new Cell(i, j, this.height, this.width, this.specs.rowSpecs[i], this.specs.colSpecs[j]);
      }
    }
    this.rows = 
  }
  
}

var a,b;
window.onload = function () {
  
  a = new LineSpecification('1,2,3');
  b = a.toStates();
};
</script>
</body>
</html>